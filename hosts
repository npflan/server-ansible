#!/bin/bash

# Get script location for explicit reference
BASEDIR=$(dirname "$0")

if [ "$1" = '--host' ]; then
  echo "{}"
  exit 0
fi

# 10.100.103.95 minecraft
# 10.100.107.137 raspberrypi

addresses=$(nmap --min-parallelism 50 --min-rate 50 -p 22 10.100.103,106,107.11-250 --open --exclude 10.100.103.223,10.100.103.95,10.100.107.137,10.100.107.107,10.100.103.228,10.100.106.163,10.100.106.115,10.100.107.68,10.100.103.243,10.100.103.131,10.100.106.43,10.100.106.237,10.100.106.20,10.100.106.116,10.100.107.189,10.100.107.171,10.100.107.219,10.100.107.19 | grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}")

output="{\n"
IFSBAK=$IFS
IFS="HEST"
output="${output} `cat $BASEDIR/hostfiles/hosts_*`\n"
output="${output}  \"npf_gameservers\": [\n"

while read -r address; do
  output="${output}    \"${address}\",\n"
done <<< "$addresses"

output="${output} ]\n}"

#echo -e `echo $output | sed 's/\(.*\),/\1/'`
echo -e $output
IFS=$IFSBAK
