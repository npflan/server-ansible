#!/bin/bash

# Get script location for explicit reference
BASEDIR=$(dirname "$0")

if [ "$1" = '--host' ]; then
  echo "{}"
  exit 0
fi

addresses=$(nmap --min-parallelism 50 --min-rate 50 -p 22 10.100.101-103.50-250 --open| grep -v "10.100.101.223" | grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}")

output="{\n"
output="${output} `cat ${BASEDIR}/hostfiles/hosts_*`\n"
output="${output}  \"gameservers-all\": [\n"

while read -r address; do
  output="${output}    \"${address}\",\n"
done <<< "$addresses"

output="${output} ],"


output="${output}\n  \"gameservers-current-rack\": [\n"

# Information om nucÃ¦rende rack
rack=$(ip -f inet address | grep 10.100 | cut -d. -f 3)
rackServers=$(printf -- "%s\n" "${addresses[@]}" | grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.$rack\.[0-9]{1,3}")


while read -r address; do
  output="${output}    \"${address}\",\n"
done <<< "$rackServers"

output="${output} ]\n}"


#echo -e `echo $output | sed 's/\(.*\),/\1/'`
echo -e $output
