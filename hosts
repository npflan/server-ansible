#!/bin/bash

if [ "$1" = '--host' ]; then
  echo "{}"
  exit 0
fi

# 10.100.103.95 minecraft
# 10.100.107.137 raspberrypi

addresses=$(nmap --min-parallelism 50 --min-rate 50 -p 22 10.100.103,106,107.11-250 --open --exclude 10.100.103.223,10.100.103.95,10.100.107.137,10.100.107.107 | grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}")

output="{\n"
IFSBAK=$IFS
IFS="HEST"
output="${output} `cat hosts_tor_switches`\n"
output="${output}  \"npf_gameservers\": [\n"

while read -r address; do
  output="${output}    \"${address}\",\n"
done <<< "$addresses"

output="${output} ]\n}"

#echo -e `echo $output | sed 's/\(.*\),/\1/'`
echo -e $output
IFS=$IFSBAK
